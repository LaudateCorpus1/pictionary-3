{% extends 'web/base.html' %}

{% block content %}
<div class="row mt-5 pt-5">
    <div class="col-12 col-sm-6 col-md-4 order-sm-2">
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">
                    Guess Word
                    <span class="float-right">
                        <i class="fas fa-stopwatch"></i> <span class="countdown"></span>
                    </span><span class="clearfix"></span>
                </h5>
            </div>
        </div>
        <div class="chat-card card">
            <div class="card-body" id="chat-content">
            </div>
            <div class="card-footer text-muted">
                <div class="float-left">
                    <button id="black-pencil" class="btn btn-secondary rounded-circle p-2 active-pen"><i class="fas fa-pencil-alt"></i></button>
                    <button id="eraser" class="btn btn-secondary rounded-circle p-2"><i class="fas fa-eraser"></i></button>
                    <button id="highlighter" class="btn btn-warning rounded-circle p-2"><i class="fas fa-highlighter"></i></button>
                </div>
                <div class="float-right">
                    <button id="yes" class="btn btn-success rounded-circle p-2"><i class="fas fa-thumbs-up"></i></button>
                    <button id="no" class="btn btn-danger rounded-circle p-2"><i class="fas fa-thumbs-down"></i></button>
                    <button id="done" class="btn btn-primary rounded-circle p-2"><i class="fas fa-check"></i></button>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-md-8 order-sm-1 text-center mt-3 mt-sm-0">
        <canvas width="300px" height="300px" id="drawing-board"></canvas>
    </div>
</div>
{{ game.id }}
{% endblock %}

{% block scripts %}
<script src="/socket.io/socket.io.js"></script>
<script type="text/paperscript" canvas="drawing-board">
    var path;
    var socket = io();
    var strokeColor = 'black';
    var strokeWidth = 3;
    var pencilId = 'black-pencil';
    
    function onMouseDown(event) {
        // If we produced a path before, deselect it:
        if (path) {
            path.selected = false;
        }

        path = new Path();
        path.strokeColor = strokeColor;
        path.strokeWidth = strokeWidth;
        msg = {'id': '{{ game.id }}', 'data': strokeColor};
        socket.emit('stroke-start', msg);
    }

    function onMouseDrag(event) {
        // Every drag event, add a point to the path at the current
        // position of the mouse:
        path.add(event.point);
        var scale = $('#drawing-board').width();
        msg = {'id': '{{ game.id }}', 'data': event.point/scale};
        socket.emit('stroke', msg);
    }

    function onMouseUp(event) {
        // When the mouse is released, simplify it:
        path.simplify();
        socket.emit('stroke-end', '{{ game.id }}');
    }

    $(function() {
        socket.emit('game', '{{ game.id }}');
        
        // Get messages from the chat room
        socket.on('chat', function(msg) {
            console.log(msg);
            $('#chat-content').append('<span class="rounded-circle"><i class="fas fa-user-circle"></i></span> <span class="rounded-pill bg-primary text-white px-3 py-2">' + msg + '</span><br>');
        });

        // Send emojis to guesser
        $('#yes').click(function(e) {
            e.preventDefault();
            socket.emit('yes', '{{ game.id }}');
            $('#chat-content').append('<i class="fas fa-thumbs-up display-4 text-success float-right"></i><span class="clearfix"></span>');
        });

        $('#no').click(function(e) {
            e.preventDefault();
            socket.emit('no', '{{ game.id }}');
            $('#chat-content').append('<i class="fas fa-thumbs-down display-4 text-danger float-right"></i><span class="clearfix"></span>');
        });

        $('#done').click(function(e) {
            e.preventDefault();
            socket.emit('done', '{{ game.id }}');
            $('#chat-content').append('<i class="fas fa-thumbs-up text-success float-right"></i><span class="clearfix"></span>');
        });

        // Update pens
        $('#black-pencil').click(function(e) {
            e.preventDefault();
            $('#' + pencilId).removeClass('active-pen');
            $('#black-pencil').addClass('active-pen');
            pencilId = 'black-pencil';
            strokeColor = 'black';
            strokeWidth = 3;
        });

        $('#eraser').click(function(e) {
            e.preventDefault();
            $('#' + pencilId).removeClass('active-pen');
            $('#eraser').addClass('active-pen');
            pencilId = 'eraser';
            strokeColor = 'white';
            strokeWidth = 10;
        });

        $('#highlighter').click(function(e) {
            e.preventDefault();
            $('#' + pencilId).removeClass('active-pen');
            $('#highlighter').addClass('active-pen');
            pencilId = 'highlighter';
            strokeColor = 'yellow';
            strokeWidth = 10;
        });

    });
</script>
{% endblock %}